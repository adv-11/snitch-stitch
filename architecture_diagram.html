<!DOCTYPE html>
<html><head><meta charset="UTF-8"><title>snitch-stitch : product requirement document</title>
<script type="module">
import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
mermaid.initialize({startOnLoad:true,theme:'default'});
window.addEventListener('load', () => {
    const moduleData = {"pyproject_Python": {"filename": "pyproject_Python.prompt", "priority": 1, "description": "Modern Python package configuration using pyproject.toml with PEP 517/518/621 compliance. Defines snitch-stitch package metadata, dependencies (click, openai, requests, gitingest), Python version requirement (>=3.9), and CLI entry point. Uses setuptools as build backend.", "dependencies": [], "tags": ["config", "packaging"], "filepath": "pyproject.toml"}, "init_Python": {"filename": "init_Python.prompt", "priority": 2, "description": "Standard Python __init__.py file for the snitch_stitch package. Exports package version and main components for import. Minimal implementation with version metadata.", "dependencies": [], "tags": ["package", "init"], "filepath": "src/snitch_stitch/__init__.py"}, "ingest_Python": {"filename": "ingest_Python.prompt", "priority": 3, "description": "Uses gitingest library to convert a local repository into a single text blob. Returns tuple of (summary, tree, content) where content contains all file contents with delimiters. Handles large repos with truncation warnings. Fatal error if gitingest fails.", "dependencies": [], "tags": ["ingest", "core"], "filepath": "src/snitch_stitch/ingest.py"}, "backend_scanner_Python": {"filename": "backend_scanner_Python.prompt", "priority": 4, "description": "Sends ingested repository content to OpenAI GPT-4o with security analysis prompt. Returns structured list of vulnerabilities with id, title, class, file, line_range, description, source, and sink. Uses JSON mode for reliable parsing. Gracefully degrades to empty list on API failure.", "dependencies": [], "tags": ["scanner", "backend", "security"], "filepath": "src/snitch_stitch/backend_scanner.py"}, "frontend_scanner_Python": {"filename": "frontend_scanner_Python.prompt", "priority": 5, "description": "Optional scanner that uses rtrvr.ai MCP endpoint to control a browser and probe running frontend for XSS, auth bypass, IDOR, and input validation issues. Only runs if RTRVR_API_KEY is set and --frontend-url is provided. Returns findings list matching backend scanner format.", "dependencies": [], "tags": ["scanner", "frontend", "security"], "filepath": "src/snitch_stitch/frontend_scanner.py"}, "ranker_Python": {"filename": "ranker_Python.prompt", "priority": 6, "description": "Takes combined findings from backend and frontend scanners. Assigns threat scores (0-10) based on exposure (public_facing=5, local_only=1), exploitability (easy=3, moderate=2, hard=1), and impact (critical=4, high=3, medium=2, low=1). Assigns severity labels (Critical/High/Medium/Low). Returns sorted list by score descending.", "dependencies": ["backend_scanner_Python.prompt", "frontend_scanner_Python.prompt"], "tags": ["ranking", "scoring"], "filepath": "src/snitch_stitch/ranker.py"}, "fixer_Python": {"filename": "fixer_Python.prompt", "priority": 7, "description": "For each selected vulnerability, extracts the relevant file content from gitingest output, sends to OpenAI with fix generation prompt. Returns original_lines and fixed_lines for exact string replacement. Uses JSON mode for reliable parsing. Handles file extraction by parsing gitingest delimiters.", "dependencies": ["ingest_Python.prompt"], "tags": ["fixer", "patches"], "filepath": "src/snitch_stitch/fixer.py"}, "diff_display_Python": {"filename": "diff_display_Python.prompt", "priority": 8, "description": "Generates unified diffs using difflib. Renders with ANSI color codes (red for deletions, green for additions). Prompts user for approval (y/n). Writes fixes to disk if approved. Handles exact string matching failures gracefully. Respects --dry-run flag.", "dependencies": [], "tags": ["diff", "ui", "apply"], "filepath": "src/snitch_stitch/diff_display.py"}, "cli_Python": {"filename": "cli_Python.prompt", "priority": 9, "description": "Click-based CLI entry point. Orchestrates: Stage 1 (ingest), Stage 2 (backend scan), Stage 3 (frontend scan if enabled), Stage 4 (ranking), Stage 5 (fix generation and application). Validates OPENAI_API_KEY is set. Handles all command-line flags (repo_path, --frontend-url, --fix-all, --dry-run, --verbose). Prints stage progress with checkmarks and summary table.", "dependencies": ["ingest_Python.prompt", "backend_scanner_Python.prompt", "frontend_scanner_Python.prompt", "ranker_Python.prompt", "fixer_Python.prompt", "diff_display_Python.prompt"], "tags": ["cli", "orchestrator"], "filepath": "src/snitch_stitch/cli.py"}};
    
    // Add hover listeners to all nodes
    setTimeout(() => {
        const nodes = document.querySelectorAll('.node');
        nodes.forEach(node => {
            const text = node.querySelector('.nodeLabel');
            if (!text) return;
            
            const nodeText = text.textContent.trim();
            const moduleId = nodeText.split(' ')[0];
            const data = moduleData[moduleId];
            
            if (data) {
                node.style.cursor = 'pointer';
                
                node.addEventListener('mouseenter', (e) => {
                    showTooltip(e, data);
                });
                
                node.addEventListener('mouseleave', () => {
                    hideTooltip();
                });
            }
        });
    }, 500);
});
function showTooltip(e, data) {
    hideTooltip();
    
    const tooltip = document.createElement('div');
    tooltip.id = 'module-tooltip';
    tooltip.innerHTML = `
        <div style="font-weight:600;margin-bottom:8px;font-size:1.1em;">${data.filename}</div>
        <div style="margin-bottom:6px;"><strong>Priority:</strong> ${data.priority}</div>
        <div style="margin-bottom:6px;"><strong>Path:</strong> ${data.filepath}</div>
        <div style="margin-bottom:6px;"><strong>Tags:</strong> ${data.tags.join(', ')}</div>
        <div style="margin-bottom:6px;"><strong>Dependencies:</strong> ${data.dependencies.length > 0 ? data.dependencies.join(', ') : 'None'}</div>
        <div style="margin-top:8px;padding-top:8px;border-top:1px solid #ddd;font-size:0.9em;color:#444;">${data.description}</div>
    `;
    
    document.body.appendChild(tooltip);
    
    const rect = e.target.closest('.node').getBoundingClientRect();
    tooltip.style.left = rect.right + 10 + 'px';
    tooltip.style.top = rect.top + window.scrollY + 'px';
}
function hideTooltip() {
    const existing = document.getElementById('module-tooltip');
    if (existing) existing.remove();
}
</script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:system-ui,sans-serif;background:#fff;color:#000;padding:2rem;max-width:1400px;margin:0 auto}
h1{font-size:2rem;font-weight:600;margin-bottom:2rem;padding-bottom:1rem;border-bottom:2px solid #000}
.diagram{border:1px solid #000;padding:2rem;margin:2rem 0;overflow-x:auto;position:relative}
.mermaid{display:flex;justify-content:center}
#module-tooltip{
    position:absolute;
    background:#fff;
    border:2px solid #000;
    padding:1rem;
    max-width:400px;
    z-index:1000;
    box-shadow:4px 4px 0 rgba(0,0,0,0.1);
    font-size:0.9rem;
    line-height:1.5;
}
.node{transition:opacity 0.2s}
.node:hover{opacity:0.8}
</style></head><body>
<h1>snitch-stitch : product requirement document</h1>
<div class="diagram"><pre class="mermaid">flowchart TB
        PRD["snitch-stitch : product requirement document"]
    
    subgraph Frontend
        frontend_scanner_Python["frontend_scanner_Python (5)"]
        diff_display_Python["diff_display_Python (8)"]
    end
    
    subgraph Backend
        backend_scanner_Python["backend_scanner_Python (4)"]
    end
    
    subgraph Shared
        pyproject_Python["pyproject_Python (1)"]
        init_Python["init_Python (2)"]
        ingest_Python["ingest_Python (3)"]
        ranker_Python["ranker_Python (6)"]
        fixer_Python["fixer_Python (7)"]
        cli_Python["cli_Python (9)"]
    end
    
    PRD --> Frontend
    PRD --> Backend

    ranker_Python -->|uses| backend_scanner_Python
    ranker_Python -->|uses| frontend_scanner_Python
    fixer_Python -->|uses| ingest_Python
    cli_Python -->|uses| ingest_Python
    cli_Python -->|uses| backend_scanner_Python
    cli_Python -->|uses| frontend_scanner_Python
    cli_Python -->|uses| ranker_Python
    cli_Python -->|uses| fixer_Python
    cli_Python -->|uses| diff_display_Python
    
    classDef frontend fill:#FFF3E0,stroke:#F57C00,stroke-width:2px
    classDef backend fill:#E3F2FD,stroke:#1976D2,stroke-width:2px
    classDef shared fill:#E8F5E9,stroke:#388E3C,stroke-width:2px
    classDef system fill:#E0E0E0,stroke:#616161,stroke-width:3px
    
    class frontend_scanner_Python,diff_display_Python frontend
    class backend_scanner_Python backend
    class pyproject_Python,init_Python,ingest_Python,ranker_Python,fixer_Python,cli_Python shared
    class PRD system</pre></div>
</body></html>