<!DOCTYPE html>
<html><head><meta charset="UTF-8"><title>4th attempt to use PDD</title>
<script type="module">
import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
mermaid.initialize({startOnLoad:true,theme:'default'});
window.addEventListener('load', () => {
    const moduleData = {"pyproject_Python": {"filename": "pyproject_Python.prompt", "priority": 1, "description": "Setuptools-based pyproject.toml configuration file declaring Python >= 3.9 compatibility, runtime dependencies (click, openai, requests, gitingest, colorama), and CLI entry point 'snitch-stitch' pointing to snitch_stitch.cli:main. Uses modern PEP 621 format with [project.scripts] for console script registration.", "dependencies": [], "tags": ["config", "python", "setuptools"], "filepath": "pyproject.toml"}, "package_init_Python": {"filename": "package_init_Python.prompt", "priority": 2, "description": "Python package __init__.py file that marks snitch_stitch as a Python package. Contains package docstring describing the tool's purpose and __version__ string for version tracking. Enables proper import resolution and package discovery for pip installation. Required for production-ready Python packages.", "dependencies": [], "tags": ["package", "python", "init"], "filepath": "snitch_stitch/__init__.py"}, "ingest_Python": {"filename": "ingest_Python.prompt", "priority": 3, "description": "Uses gitingest.ingest() to convert local Git repository to a single concatenated text string respecting .gitignore patterns. Returns ingested content and warnings if truncation occurs. Handles errors gracefully with fallback to empty string. Exposes ingest_repository(repo_path: str) -> tuple[str, list[str]] function.", "dependencies": [], "tags": ["backend", "ingestion"], "filepath": "snitch_stitch/ingest.py"}, "backend_scanner_Python": {"filename": "backend_scanner_Python.prompt", "priority": 4, "description": "Sends ingested repository content to OpenAI GPT-4o with security auditor system prompt. Uses Structured Outputs to guarantee JSON schema compliance for findings array. Each finding includes: id, title, class (e.g. 'SQL Injection'), file, line_range, description, source, sink. Handles API errors gracefully, returns empty list on failure. Exposes scan_backend(repo_content: str, verbose: bool) -> list[dict] function.", "dependencies": [], "tags": ["backend", "security", "openai"], "filepath": "snitch_stitch/backend_scanner.py"}, "frontend_scanner_Python": {"filename": "frontend_scanner_Python.prompt", "priority": 5, "description": "Optional module that uses rtrvr.ai MCP browser automation to scan frontend URLs. Only runs if RTRVR_API_KEY environment variable is set and --frontend-url CLI flag provided. Tests for XSS, auth bypass, IDOR, missing validation, and secrets exposure. Returns findings array with: id, title, class, description, url, steps. Uses requests library to communicate with MCP server at https://mcp.rtrvr.ai/. Handles failures gracefully.", "dependencies": [], "tags": ["frontend", "security", "browser"], "filepath": "snitch_stitch/frontend_scanner.py"}, "ranker_Python": {"filename": "ranker_Python.prompt", "priority": 6, "description": "Merges backend and frontend findings, deduplicates by file+line_range or url+class combinations. Scores each finding 0-10 based on exposure, exploitability, and impact factors. Assigns severity labels: Critical (9-10), High (7-8), Medium (4-6), Low (0-3). Returns sorted list of ranked findings. Pure Python logic with no external dependencies. Exposes rank_findings(backend_findings: list[dict], frontend_findings: list[dict]) -> list[dict] function.", "dependencies": [], "tags": ["backend", "scoring"], "filepath": "snitch_stitch/ranker.py"}, "diff_display_Python": {"filename": "diff_display_Python.prompt", "priority": 7, "description": "Uses Python difflib.unified_diff to generate unified diffs from original and fixed code. Applies colorama for cross-platform colored terminal output (red for removals, green for additions). Handles line terminator edge cases. Exposes show_diff(original: str, fixed: str, filepath: str) -> str function for display, and apply_patch(filepath: str, original_lines: str, fixed_lines: str, dry_run: bool) -> bool for writing changes to disk.", "dependencies": [], "tags": ["backend", "display", "diff"], "filepath": "snitch_stitch/diff_display.py"}, "fixer_Python": {"filename": "fixer_Python.prompt", "priority": 8, "description": "For each selected finding, extracts relevant file content from ingested repo text and sends to OpenAI with finding details. Uses Structured Outputs to guarantee JSON response with original_lines and fixed_lines fields. Performs exact substring matching to locate code blocks. Delegates to diff_display module for showing diffs and applying changes. Handles missing files gracefully. Exposes fix_finding(finding: dict, repo_content: str, dry_run: bool, verbose: bool) -> bool function.", "dependencies": ["diff_display_Python.prompt"], "tags": ["backend", "fixes", "openai"], "filepath": "snitch_stitch/fixer.py"}, "cli_Python": {"filename": "cli_Python.prompt", "priority": 9, "description": "Click-based command-line interface implementing snitch-stitch command with options: --frontend-url, --fix-all, --dry-run, --verbose. Orchestrates all stages: (1) ingest repo, (2) scan backend, (3) scan frontend if enabled, (4) rank findings, (5) display summary table and apply fixes. Validates OPENAI_API_KEY is set, exits with code 1 if missing. Handles user finding selection via interactive prompts unless --fix-all specified. Entry point: main() function.", "dependencies": ["ingest_Python.prompt", "backend_scanner_Python.prompt", "frontend_scanner_Python.prompt", "ranker_Python.prompt", "fixer_Python.prompt"], "tags": ["cli", "orchestration"], "filepath": "snitch_stitch/cli.py"}};
    
    // Add hover listeners to all nodes
    setTimeout(() => {
        const nodes = document.querySelectorAll('.node');
        nodes.forEach(node => {
            const text = node.querySelector('.nodeLabel');
            if (!text) return;
            
            const nodeText = text.textContent.trim();
            const moduleId = nodeText.split(' ')[0];
            const data = moduleData[moduleId];
            
            if (data) {
                node.style.cursor = 'pointer';
                
                node.addEventListener('mouseenter', (e) => {
                    showTooltip(e, data);
                });
                
                node.addEventListener('mouseleave', () => {
                    hideTooltip();
                });
            }
        });
    }, 500);
});
function showTooltip(e, data) {
    hideTooltip();
    
    const tooltip = document.createElement('div');
    tooltip.id = 'module-tooltip';
    tooltip.innerHTML = `
        <div style="font-weight:600;margin-bottom:8px;font-size:1.1em;">${data.filename}</div>
        <div style="margin-bottom:6px;"><strong>Priority:</strong> ${data.priority}</div>
        <div style="margin-bottom:6px;"><strong>Path:</strong> ${data.filepath}</div>
        <div style="margin-bottom:6px;"><strong>Tags:</strong> ${data.tags.join(', ')}</div>
        <div style="margin-bottom:6px;"><strong>Dependencies:</strong> ${data.dependencies.length > 0 ? data.dependencies.join(', ') : 'None'}</div>
        <div style="margin-top:8px;padding-top:8px;border-top:1px solid #ddd;font-size:0.9em;color:#444;">${data.description}</div>
    `;
    
    document.body.appendChild(tooltip);
    
    const rect = e.target.closest('.node').getBoundingClientRect();
    tooltip.style.left = rect.right + 10 + 'px';
    tooltip.style.top = rect.top + window.scrollY + 'px';
}
function hideTooltip() {
    const existing = document.getElementById('module-tooltip');
    if (existing) existing.remove();
}
</script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:system-ui,sans-serif;background:#fff;color:#000;padding:2rem;max-width:1400px;margin:0 auto}
h1{font-size:2rem;font-weight:600;margin-bottom:2rem;padding-bottom:1rem;border-bottom:2px solid #000}
.diagram{border:1px solid #000;padding:2rem;margin:2rem 0;overflow-x:auto;position:relative}
.mermaid{display:flex;justify-content:center}
#module-tooltip{
    position:absolute;
    background:#fff;
    border:2px solid #000;
    padding:1rem;
    max-width:400px;
    z-index:1000;
    box-shadow:4px 4px 0 rgba(0,0,0,0.1);
    font-size:0.9rem;
    line-height:1.5;
}
.node{transition:opacity 0.2s}
.node:hover{opacity:0.8}
</style></head><body>
<h1>4th attempt to use PDD</h1>
<div class="diagram"><pre class="mermaid">flowchart TB
        PRD["4th attempt to use PDD"]
    
    subgraph Frontend
        frontend_scanner_Python["frontend_scanner_Python (5)"]
    end
    
    subgraph Backend
        ingest_Python["ingest_Python (3)"]
        backend_scanner_Python["backend_scanner_Python (4)"]
        ranker_Python["ranker_Python (6)"]
        diff_display_Python["diff_display_Python (7)"]
        fixer_Python["fixer_Python (8)"]
    end
    
    subgraph Shared
        pyproject_Python["pyproject_Python (1)"]
        package_init_Python["package_init_Python (2)"]
        cli_Python["cli_Python (9)"]
    end
    
    PRD --> Frontend
    PRD --> Backend

    fixer_Python -->|uses| diff_display_Python
    cli_Python -->|uses| ingest_Python
    cli_Python -->|uses| backend_scanner_Python
    cli_Python -->|uses| frontend_scanner_Python
    cli_Python -->|uses| ranker_Python
    cli_Python -->|uses| fixer_Python
    
    classDef frontend fill:#FFF3E0,stroke:#F57C00,stroke-width:2px
    classDef backend fill:#E3F2FD,stroke:#1976D2,stroke-width:2px
    classDef shared fill:#E8F5E9,stroke:#388E3C,stroke-width:2px
    classDef system fill:#E0E0E0,stroke:#616161,stroke-width:3px
    
    class frontend_scanner_Python frontend
    class ingest_Python,backend_scanner_Python,ranker_Python,diff_display_Python,fixer_Python backend
    class pyproject_Python,package_init_Python,cli_Python shared
    class PRD system</pre></div>
</body></html>