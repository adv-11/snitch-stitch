[
  {
    "reason": "Project configuration defines package metadata and CLI entry point",
    "description": "Setuptools-based pyproject.toml configuration file declaring Python >= 3.9 compatibility, runtime dependencies (click, openai, requests, gitingest, colorama), and CLI entry point 'snitch-stitch' pointing to snitch_stitch.cli:main. Uses modern PEP 621 format with [project.scripts] for console script registration.",
    "dependencies": [],
    "priority": 1,
    "filename": "pyproject_Python.prompt",
    "filepath": "pyproject.toml",
    "tags": [
      "config",
      "python",
      "setuptools"
    ],
    "context_urls": [
      {
        "url": "https://setuptools.pypa.io/en/latest/userguide/pyproject_config.html",
        "purpose": "Official setuptools pyproject.toml configuration reference"
      },
      {
        "url": "https://packaging.python.org/en/latest/guides/writing-pyproject-toml/",
        "purpose": "Python packaging guide for pyproject.toml format and best practices"
      },
      {
        "url": "https://setuptools.pypa.io/en/latest/userguide/entry_point.html",
        "purpose": "Console scripts entry point configuration for CLI tools"
      }
    ],
    "interface": {
      "type": "config",
      "config": {
        "keys": [
          {
            "name": "OPENAI_API_KEY",
            "type": "string",
            "required": true,
            "source": "env"
          },
          {
            "name": "RTRVR_API_KEY",
            "type": "string",
            "required": false,
            "source": "env"
          }
        ]
      }
    }
  },
  {
    "reason": "Package initialization file defines package metadata and version",
    "description": "Python package __init__.py file that marks snitch_stitch as a Python package. Contains package docstring describing the tool's purpose and __version__ string for version tracking. Enables proper import resolution and package discovery for pip installation. Required for production-ready Python packages.",
    "dependencies": [],
    "priority": 2,
    "filename": "package_init_Python.prompt",
    "filepath": "snitch_stitch/__init__.py",
    "tags": [
      "package",
      "python",
      "init"
    ],
    "context_urls": [
      {
        "url": "https://docs.python.org/3/tutorial/modules.html#packages",
        "purpose": "Python packages and __init__.py documentation"
      },
      {
        "url": "https://packaging.python.org/en/latest/guides/packaging-namespace-packages/",
        "purpose": "Python packaging guide for package initialization"
      }
    ],
    "interface": {
      "type": "module",
      "module": {
        "functions": [],
        "exports": [
          {
            "name": "__version__",
            "type": "str",
            "description": "Package version string"
          }
        ]
      }
    }
  },
  {
    "reason": "Repository ingestion module converts Git repos to LLM-friendly text",
    "description": "Uses gitingest.ingest() to convert local Git repository to a single concatenated text string respecting .gitignore patterns. Returns ingested content and warnings if truncation occurs. Handles errors gracefully with fallback to empty string. Exposes ingest_repository(repo_path: str) -> tuple[str, list[str]] function.",
    "dependencies": [],
    "priority": 3,
    "filename": "ingest_Python.prompt",
    "filepath": "snitch_stitch/ingest.py",
    "tags": [
      "backend",
      "ingestion"
    ],
    "context_urls": [
      {
        "url": "https://pypi.org/project/gitingest/",
        "purpose": "gitingest library documentation for repository ingestion API"
      },
      {
        "url": "https://github.com/cyclotruc/gitingest",
        "purpose": "gitingest GitHub repository with usage examples and API reference"
      }
    ],
    "interface": {
      "type": "module",
      "module": {
        "functions": [
          {
            "name": "ingest_repository",
            "signature": "def ingest_repository(repo_path: str) -> tuple[str, list[str]]",
            "returns": "Tuple of (ingested_content: str, warnings: list[str])",
            "errors": [
              "gitingest.IngestError"
            ],
            "sideEffects": "Reads files from disk within repo_path"
          }
        ]
      }
    }
  },
  {
    "reason": "Backend scanner analyzes repository code for security vulnerabilities using LLM",
    "description": "Sends ingested repository content to OpenAI GPT-4o with security auditor system prompt. Uses Structured Outputs to guarantee JSON schema compliance for findings array. Each finding includes: id, title, class (e.g. 'SQL Injection'), file, line_range, description, source, sink. Handles API errors gracefully, returns empty list on failure. Exposes scan_backend(repo_content: str, verbose: bool) -> list[dict] function.",
    "dependencies": [],
    "priority": 4,
    "filename": "backend_scanner_Python.prompt",
    "filepath": "snitch_stitch/backend_scanner.py",
    "tags": [
      "backend",
      "security",
      "openai"
    ],
    "context_urls": [
      {
        "url": "https://platform.openai.com/docs/api-reference/chat",
        "purpose": "OpenAI Chat Completions API reference for GPT-4o integration"
      },
      {
        "url": "https://platform.openai.com/docs/guides/structured-outputs",
        "purpose": "Structured Outputs guide for guaranteed JSON schema compliance"
      },
      {
        "url": "https://github.com/openai/openai-python",
        "purpose": "OpenAI Python SDK documentation and usage examples"
      }
    ],
    "interface": {
      "type": "module",
      "module": {
        "functions": [
          {
            "name": "scan_backend",
            "signature": "def scan_backend(repo_content: str, verbose: bool = False) -> list[dict]",
            "returns": "List of finding dictionaries with keys: id, title, class, file, line_range, description, source, sink",
            "errors": [
              "openai.APIError",
              "json.JSONDecodeError"
            ],
            "sideEffects": "Makes API calls to OpenAI (requires OPENAI_API_KEY)"
          }
        ]
      }
    }
  },
  {
    "reason": "Frontend scanner probes running web applications for client-side vulnerabilities",
    "description": "Optional module that uses rtrvr.ai MCP browser automation to scan frontend URLs. Only runs if RTRVR_API_KEY environment variable is set and --frontend-url CLI flag provided. Tests for XSS, auth bypass, IDOR, missing validation, and secrets exposure. Returns findings array with: id, title, class, description, url, steps. Uses requests library to communicate with MCP server at https://mcp.rtrvr.ai/. Handles failures gracefully.",
    "dependencies": [],
    "priority": 5,
    "filename": "frontend_scanner_Python.prompt",
    "filepath": "snitch_stitch/frontend_scanner.py",
    "tags": [
      "frontend",
      "security",
      "browser"
    ],
    "context_urls": [
      {
        "url": "https://www.rtrvr.ai/docs",
        "purpose": "rtrvr.ai documentation for MCP browser automation API"
      },
      {
        "url": "https://requests.readthedocs.io/",
        "purpose": "Python requests library documentation for HTTP API calls"
      }
    ],
    "interface": {
      "type": "module",
      "module": {
        "functions": [
          {
            "name": "scan_frontend",
            "signature": "def scan_frontend(frontend_url: str, verbose: bool = False) -> list[dict]",
            "returns": "List of finding dictionaries with keys: id, title, class, description, url, steps",
            "errors": [
              "requests.RequestException",
              "json.JSONDecodeError"
            ],
            "sideEffects": "Makes API calls to rtrvr.ai MCP server (requires RTRVR_API_KEY)"
          }
        ]
      }
    }
  },
  {
    "reason": "Ranker merges, deduplicates, and scores security findings by severity",
    "description": "Merges backend and frontend findings, deduplicates by file+line_range or url+class combinations. Scores each finding 0-10 based on exposure, exploitability, and impact factors. Assigns severity labels: Critical (9-10), High (7-8), Medium (4-6), Low (0-3). Returns sorted list of ranked findings. Pure Python logic with no external dependencies. Exposes rank_findings(backend_findings: list[dict], frontend_findings: list[dict]) -> list[dict] function.",
    "dependencies": [],
    "priority": 6,
    "filename": "ranker_Python.prompt",
    "filepath": "snitch_stitch/ranker.py",
    "tags": [
      "backend",
      "scoring"
    ],
    "interface": {
      "type": "module",
      "module": {
        "functions": [
          {
            "name": "rank_findings",
            "signature": "def rank_findings(backend_findings: list[dict], frontend_findings: list[dict]) -> list[dict]",
            "returns": "List of ranked findings with added 'score' and 'severity' keys, sorted by score descending",
            "errors": [],
            "sideEffects": "None (pure function)"
          }
        ]
      }
    }
  },
  {
    "reason": "Diff display module generates and shows colored unified diffs for patches",
    "description": "Uses Python difflib.unified_diff to generate unified diffs from original and fixed code. Applies colorama for cross-platform colored terminal output (red for removals, green for additions). Handles line terminator edge cases. Exposes show_diff(original: str, fixed: str, filepath: str) -> str function for display, and apply_patch(filepath: str, original_lines: str, fixed_lines: str, dry_run: bool) -> bool for writing changes to disk.",
    "dependencies": [],
    "priority": 7,
    "filename": "diff_display_Python.prompt",
    "filepath": "snitch_stitch/diff_display.py",
    "tags": [
      "backend",
      "display",
      "diff"
    ],
    "context_urls": [
      {
        "url": "https://docs.python.org/3/library/difflib.html",
        "purpose": "Python difflib module documentation for unified diff generation"
      },
      {
        "url": "https://pypi.org/project/colorama/",
        "purpose": "Colorama documentation for cross-platform colored terminal output"
      }
    ],
    "interface": {
      "type": "module",
      "module": {
        "functions": [
          {
            "name": "show_diff",
            "signature": "def show_diff(original: str, fixed: str, filepath: str) -> str",
            "returns": "Colored unified diff string for terminal display",
            "errors": [],
            "sideEffects": "None (pure function)"
          },
          {
            "name": "apply_patch",
            "signature": "def apply_patch(filepath: str, original_lines: str, fixed_lines: str, dry_run: bool = False) -> bool",
            "returns": "True if patch applied successfully, False otherwise",
            "errors": [
              "FileNotFoundError",
              "ValueError"
            ],
            "sideEffects": "Writes to disk unless dry_run=True"
          }
        ]
      }
    }
  },
  {
    "reason": "Fixer generates and applies LLM-based patches for security vulnerabilities",
    "description": "For each selected finding, extracts relevant file content from ingested repo text and sends to OpenAI with finding details. Uses Structured Outputs to guarantee JSON response with original_lines and fixed_lines fields. Performs exact substring matching to locate code blocks. Delegates to diff_display module for showing diffs and applying changes. Handles missing files gracefully. Exposes fix_finding(finding: dict, repo_content: str, dry_run: bool, verbose: bool) -> bool function.",
    "dependencies": [
      "diff_display_Python.prompt"
    ],
    "priority": 8,
    "filename": "fixer_Python.prompt",
    "filepath": "snitch_stitch/fixer.py",
    "tags": [
      "backend",
      "fixes",
      "openai"
    ],
    "context_urls": [
      {
        "url": "https://platform.openai.com/docs/guides/structured-outputs",
        "purpose": "Structured Outputs guide for guaranteed JSON schema in patch generation"
      },
      {
        "url": "https://docs.python.org/3/library/difflib.html",
        "purpose": "difflib for string matching and diff operations"
      }
    ],
    "interface": {
      "type": "module",
      "module": {
        "functions": [
          {
            "name": "fix_finding",
            "signature": "def fix_finding(finding: dict, repo_content: str, dry_run: bool = False, verbose: bool = False) -> bool",
            "returns": "True if fix applied successfully, False otherwise",
            "errors": [
              "openai.APIError",
              "FileNotFoundError",
              "ValueError"
            ],
            "sideEffects": "Writes to disk unless dry_run=True, makes OpenAI API calls"
          }
        ]
      }
    }
  },
  {
    "reason": "CLI orchestrates the full 5-stage security audit workflow",
    "description": "Click-based command-line interface implementing snitch-stitch command with options: --frontend-url, --fix-all, --dry-run, --verbose. Orchestrates all stages: (1) ingest repo, (2) scan backend, (3) scan frontend if enabled, (4) rank findings, (5) display summary table and apply fixes. Validates OPENAI_API_KEY is set, exits with code 1 if missing. Handles user finding selection via interactive prompts unless --fix-all specified. Entry point: main() function.",
    "dependencies": [
      "ingest_Python.prompt",
      "backend_scanner_Python.prompt",
      "frontend_scanner_Python.prompt",
      "ranker_Python.prompt",
      "fixer_Python.prompt"
    ],
    "priority": 9,
    "filename": "cli_Python.prompt",
    "filepath": "snitch_stitch/cli.py",
    "tags": [
      "cli",
      "orchestration"
    ],
    "context_urls": [
      {
        "url": "https://click.palletsprojects.com/",
        "purpose": "Click framework documentation for building Python CLI applications"
      },
      {
        "url": "https://click.palletsprojects.com/en/stable/quickstart/",
        "purpose": "Click quickstart guide for command options and arguments"
      }
    ],
    "interface": {
      "type": "cli",
      "cli": {
        "commands": [
          {
            "name": "snitch-stitch",
            "args": [],
            "flags": [
              {
                "name": "--frontend-url",
                "type": "string",
                "description": "Enable frontend scanning with URL"
              },
              {
                "name": "--fix-all",
                "type": "boolean",
                "description": "Attempt to fix all findings without selection"
              },
              {
                "name": "--dry-run",
                "type": "boolean",
                "description": "Show diffs only, never write files"
              },
              {
                "name": "--verbose",
                "type": "boolean",
                "description": "Print debug output"
              }
            ],
            "exitCodes": [
              {
                "code": 0,
                "description": "Success"
              },
              {
                "code": 1,
                "description": "Missing OPENAI_API_KEY or critical error"
              }
            ]
          }
        ],
        "io": {
          "stdin": "Optional user input for finding selection",
          "stdout": "Colored terminal output with findings table and diffs"
        }
      }
    }
  }
]